import{Q as he}from"./QPage.ff17a0c6.js";import{d as Pe,u as Ce,r as p,ar as k,w as Se,S as s,U as ke,V as be,a4 as t,X as o,a2 as n,Z as d,f as C,G as c,ae as y,F as I,$ as U,W as b,as as H,at as ue,a3 as Q,af as xe,ac as W,au as de,av as ce,aw as De,ax as Ie,ak as Ue,al as Te}from"./index.db1ac400.js";import{u as we}from"./composables.43cac92b.js";import{_ as Re}from"./plugin-vue_export-helper.21dcd24c.js";import{u as Ae}from"./vue-i18n.runtime.444512b2.js";const $=B=>(Ue("data-v-9de3c950"),B=B(),Te(),B),Ve={key:0,class:"practitioner"},Ee=["onClick"],Me={class:"patient"},Oe=["value"],ze={class:"vaccinations"},Ne=["value"],Fe=["value"],Le=["onClick"],_e={class:"risks"},He=["value"],Be=["value"],je=["onClick"],Ge=$(()=>t("hr",null,null,-1)),Je=$(()=>t("br",null,null,-1)),Ke=$(()=>t("br",null,null,-1)),Qe=["disabled"],We={key:5,class:"resource"},Z="en-US",Xe=Pe({__name:"CreatePage",setup(B){var te,ne,ie;const{t:r}=Ae(),u=Ce(),pe=we(),f=p(),j=p(!1),S=p({done:!1,error:!1,processing:!1});let T=p(!0);u.practitioners.length===0&&u.practitioners.push({uuid:k(),prefix:"Dr. med.",given:"Hanspeter",family:"Wenger",org:"Klinik H\xF6heweg"});let N=p("Dr. med."),R=p(""),A=p(""),V=p("");function me(){u.practitioners.push({uuid:k(),prefix:N.value,given:R.value,family:A.value,org:V.value}),R.value=A.value=V.value=""}let G=p(new Array),m=p({id:"",display:"",date:"",completed:!1,performer:u.practitioners[0]?u.practitioners[0].uuid:"",lot:"",dose:1});ee();let J=p(new Array),h=p({id:"",display:"",date:"",onSetDate:"",recorder:u.practitioners[0]?u.practitioners[0].uuid:""});const X=u.userResource.name?u.userResource.name[0]||{family:"",given:[""]}:{family:"",given:[""]};let E=p((te=X.given)==null?void 0:te.reduce((l,i)=>l+" "+i)),w=p(X.family+""),F=p((ne=u.userResource.gender)==null?void 0:ne.toUpperCase()),M=p(((ie=u.userResource)==null?void 0:ie.birthDate)+"");function x(l){var i;(i=f.value)!=null&&i.entry&&f.value.entry.push({fullUrl:"https://www.e-health-suisse.ch/"+l.resourceType+"/"+l.id,resource:l})}function q(l){const i=u.practitioners.find(e=>e.uuid===l);if(!i)throw new Error("Can not find Practitioner "+l+" - it has probably been deleted after being referenced.");return{uuid:l,practitioner:{resourceType:"Practitioner",id:"practitioner-"+l,identifier:[{system:"urn:ietf:rfc:3986",value:"urn:uuid:"+k()}],name:[{prefix:[i.prefix],family:i.family,given:i.given.split(" ")}]},organisation:{resourceType:"Organization",id:"organization-"+l,name:i.org},practitionerRole:{resourceType:"PractitionerRole",id:"role-"+l,practitioner:{reference:"Practitioner/practitioner-"+l},organization:{reference:"Organization/organization-"+l}}}}function ee(){m.value.lot=(Math.random()+1).toString(36).substring(4).toUpperCase()}function fe(){var se;S.value={error:!1,done:!1,processing:!1};const l="urn:oid:2.16.756.5.30.1.178.1.1",i=Math.floor(Math.random()*100)+"."+Math.floor(Math.random()*100)+"."+Math.floor(Math.random()*100),e=p("Immunization Administration"),g=new Date().toISOString(),D=[];f.value={resourceType:"Bundle",id:k(),meta:{profile:["http://fhir.ch/ig/ch-vacd/StructureDefinition/ch-vacd-document-vaccination-record"]},identifier:{system:"urn:ietf:rfc:3986",value:"urn:uuid:"+k()},type:W.BundleType.DOCUMENT,timestamp:g,entry:[]};const oe={resourceType:"Patient",id:"patientauthor",identifier:[{system:"urn:ietf:rfc:3986",value:"urn:uuid:"+k()}],active:!0,name:[{family:"system",given:["generated by"],prefix:["document"]}]},K={active:!0,id:"Patient-"+i,identifier:[{system:l,value:"PAT."+i}],meta:{profile:["http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-patient","http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-patient-epr"]},name:[{family:w.value,given:(se=E.value)==null?void 0:se.split(" ")}],gender:F.value.toLowerCase(),birthDate:M.value,resourceType:"Patient"},re=k(),Y={id:re,identifier:{system:"urn:ietf:rfc:3986",value:"urn:uuid:"+re},language:Z,status:W.CompositionStatus.FINAL,type:{coding:[{system:"http://snomed.info/sct",code:"41000179103",display:"Immunization record"}]},subject:{type:"Patient",reference:"Patient/"+K.id},date:g,author:[{reference:"Patient/"+oe.id}],title:e.value,resourceType:"Composition",confidentiality:"N",_confidentiality:{extension:[{url:"http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-confidentialitycode",valueCodeableConcept:{coding:[{system:"2.16.840.1.113883.6.96",code:"17621005",display:"Normal"}]}}]}},ae={id:"administration",title:"Immunization Administration",code:{coding:[{system:"http://loinc.org",code:"11369-6",display:"Hx of Immunization"}]},entry:[]},ye={id:"pastillnesses",title:"Undergone illnesses for immunization",code:{coding:[{system:"http://loinc.org",code:"11348-0",display:'Hx of Past illness"'}]},entry:[]},ve={id:"allergies",title:"Allergies and adverse reactions Document",code:{coding:[{system:"http://loinc.org",code:"48765-2",display:'Allergies and adverse reactions Document"'}]},entry:[]},le={id:"medicalproblems",title:"Problem list Reported",code:{coding:[{system:"http://loinc.org",code:"11450-4",display:"Problem list Reported"}]},entry:[]};x(Y),x(oe),x(K),G.value.forEach(a=>{let v=D.find(_=>_.uuid===a.performer);v||(v=q(a.performer),D.push(v));const P=de.find(_=>_.code===a.id);if(!P)throw new Error("Can not find vaccination for code "+a.id);const O=new Date(a.date);O.setHours(Math.floor(Math.random()*8)+8),O.setMinutes(Math.floor(Math.random()*60));const L=k(),z={id:L,identifier:[{system:"urn:ietf:rfc:3986",value:"urn:uuid:"+L}],resourceType:"Immunization",vaccineCode:{coding:[{system:P.system,code:P.code,display:P.display}]},patient:{reference:"Patient/"+K.id},occurrenceDateTime:O.toISOString(),performer:[{actor:{reference:"PractitionerRole/"+v.practitionerRole.id}}],status:a.completed?W.ImmunizationStatus.COMPLETED:W.ImmunizationStatus.NOT_DONE,lotNumber:a.lot,protocolApplied:[{targetDisease:P.target.map(_=>({coding:[_]})),doseNumberPositiveInt:a.dose}]};ae.entry.push({reference:"Immunization/"+z.id}),x(z)}),J.value.forEach(a=>{let v=D.find(z=>z.uuid===a.recorder);v||(v=q(a.recorder),D.push(v));const P=ce.find(z=>z.code===a.id);if(!P)throw new Error("Can not find risk for code "+a.id);const O=k(),L={id:O,resourceType:"Condition",meta:{profile:["http://fhir.ch/ig/ch-vacd/StructureDefinition/ch-vacd-composition-vaccination-record"]},language:Z,identifier:[{system:"urn:ietf:rfc:3986",value:"urn:uuid:"+O}],category:[{coding:[{system:"http://terminology.hl7.org/CodeSystem/condition-category",code:"problem-list-item",display:"Problem List Item"}]}],code:{coding:[{system:P.system,code:P.code,display:P.display[Z]}]},clinicalStatus:{coding:[{system:"http://terminology.hl7.org/CodeSystem/condition-clinical",code:"resolved",display:"Resolved"}]},verificationStatus:{coding:[{system:"http://terminology.hl7.org/CodeSystem/condition-ver-status",code:"confirmed",display:"Confirmed"}]},recordedDate:new Date(a.date).toISOString(),onsetDateTime:new Date(a.onSetDate).toISOString(),subject:{reference:"Patient/"+K.id},recorder:{reference:"PractitionerRole/"+v.practitionerRole.id}};le.entry.push({reference:"Condition/"+L.id}),x(L)}),Y.section=[],[ae,ye,ve,le].forEach(a=>{var v;a.entry&&a.entry.length>0&&((v=Y.section)==null||v.push(a))}),D.forEach(a=>{x(a.practitionerRole),x(a.practitioner),x(a.organisation)}),j.value&&navigator.clipboard.writeText(JSON.stringify(f.value,null,2))}function ge(){S.value={error:!1,done:!1,processing:!0};const l=new Intl.DateTimeFormat("de-CH").format(new Date);if(f.value){const i={title:"Impfdokumentation vom "+l,isFhir:!0,description:"Die Impfdokumentation von "+E.value+" "+w.value+", generiert am "+l+".",contentLanguage:"de-CH",sourceIdentifier:u.userSettings.OIDs.app,categoryCoding:{system:"http://snomed.info/sct",code:"184216000",display:"Patient record type"},typeCoding:{system:"http://snomed.info/sct",code:"41000179103",display:"Immunization record"},facilityCoding:{system:"http://snomed.info/sct",code:"264358009",display:"General practice premises"},practiceSettingCoding:{system:"http://snomed.info/sct",code:"394802001",display:"General medicine"},authorRole:De.PAT};Ie(f.value,u.userResource,i,pe).then(()=>{S.value={error:!1,done:!0,processing:!1}}).catch(e=>{console.error("Can not upload resource",e,f.value),S.value={error:!0,done:!1,processing:!1}})}}return Se(j,l=>{l&&navigator.clipboard.writeText(JSON.stringify(f.value,null,2))}),(l,i)=>(s(),ke(he,{class:"full-width justify-center content-start page"},{default:be(()=>[t("h2",null,o(n(r)("createPage.title")),1),n(T)?(s(),d("div",Ve,[t("a",{onClick:i[0]||(i[0]=e=>C(T)?T.value=!1:T=!1)},"["+o(n(r)("createPage.practitioners.hide"))+"]",1),t("h3",null,o(n(r)("createPage.practitioners.title")),1),t("table",null,[t("tr",null,[t("td",null,o(n(r)("createPage.prefix")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[1]||(i[1]=e=>C(N)?N.value=e:N=e)},null,512),[[y,n(N)]])])]),t("tr",null,[t("td",null,o(n(r)("createPage.given")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[2]||(i[2]=e=>C(R)?R.value=e:R=e)},null,512),[[y,n(R)]])])]),t("tr",null,[t("td",null,o(n(r)("createPage.family")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[3]||(i[3]=e=>C(A)?A.value=e:A=e)},null,512),[[y,n(A)]])])]),t("tr",null,[t("td",null,o(n(r)("createPage.practitioners.organization")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[4]||(i[4]=e=>C(V)?V.value=e:V=e)},null,512),[[y,n(V)]])])])]),t("button",{onClick:me},o(n(r)("createPage.add")),1),t("ul",null,[(s(!0),d(I,null,U(n(u).practitioners,(e,g)=>(s(),d("li",{key:"practi-"+g},[b(o(e.prefix+" "+e.given+" "+e.family+" ("+e.org+")")+" ",1),t("a",{onClick:D=>n(u).practitioners.splice(g,1)},"[x]",8,Ee)]))),128))])])):(s(),d("a",{key:1,onClick:i[5]||(i[5]=e=>C(T)?T.value=!0:T=!0)},o(n(r)("createPage.practitioners.show")),1)),t("div",Me,[t("h3",null,o(n(r)("createPage.patient.title")),1),t("table",null,[t("tr",null,[t("td",null,o(n(r)("createPage.given")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[6]||(i[6]=e=>C(E)?E.value=e:E=e)},null,512),[[y,n(E)]])])]),t("tr",null,[t("td",null,o(n(r)("createPage.family")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[7]||(i[7]=e=>C(w)?w.value=e:w=e)},null,512),[[y,n(w)]])])]),t("tr",null,[t("td",null,o(n(r)("createPage.patient.birthdate")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[8]||(i[8]=e=>C(M)?M.value=e:M=e)},null,512),[[y,n(M)]])])]),t("tr",null,[t("td",null,o(n(r)("createPage.gender.label")),1),t("td",null,[c(t("select",{"onUpdate:modelValue":i[9]||(i[9]=e=>C(F)?F.value=e:F=e)},[(s(),d(I,null,U(["MALE","FEMALE","OTHER"],e=>t("option",{key:e,value:e},o(n(r)("createPage.gender."+e)),9,Oe)),64))],512),[[H,n(F)]])])])])]),t("div",ze,[t("h3",null,o(n(r)("createPage.vaccinations.title")),1),t("table",null,[t("tr",null,[t("td",null,o(n(r)("createPage.id")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[10]||(i[10]=e=>n(m).id=e)},null,512),[[y,n(m).id]]),b("\xA0 "),c(t("select",{"onUpdate:modelValue":i[11]||(i[11]=e=>n(m).id=e)},[(s(!0),d(I,null,U(n(de).sort((e,g)=>e.display>g.display?1:-1),e=>(s(),d("option",{key:e.code,value:e.code},o(e.display),9,Ne))),128))],512),[[H,n(m).id]])])]),t("tr",null,[t("td",null,o(n(r)("createPage.vaccinations.date")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[12]||(i[12]=e=>n(m).date=e)},null,512),[[y,n(m).date]])])]),t("tr",null,[t("td",null,o(n(r)("createPage.vaccinations.lot")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[13]||(i[13]=e=>n(m).lot=e)},null,512),[[y,n(m).lot]]),t("span",{onClick:ee}," \u21BA")])]),t("tr",null,[t("td",null,o(n(r)("createPage.vaccinations.dose")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[14]||(i[14]=e=>n(m).dose=e),type:"number"},null,512),[[y,n(m).dose]])])]),t("tr",null,[t("td",null,o(n(r)("createPage.vaccinations.completed")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[15]||(i[15]=e=>n(m).completed=e),type:"checkbox"},null,512),[[ue,n(m).completed]])])]),t("tr",null,[t("td",null,o(n(r)("createPage.vaccinations.performer")),1),t("td",null,[c(t("select",{"onUpdate:modelValue":i[16]||(i[16]=e=>n(m).performer=e)},[(s(!0),d(I,null,U(n(u).practitioners,e=>(s(),d("option",{key:e.uuid,value:e.uuid},o(e.prefix+" "+e.given+" "+e.family+" ("+e.org+")"),9,Fe))),128))],512),[[H,n(m).performer]])])])]),t("button",{onClick:i[17]||(i[17]=e=>n(G).push({...n(m)}))},o(n(r)("createPage.add")),1),t("ul",null,[(s(!0),d(I,null,U(n(G),(e,g)=>(s(),d("li",{key:e.id},[b(o(e.id+" (dose: "+e.dose+(e.completed?" \u2714\uFE0F":" \u2716\uFE0F")+", lot: "+e.lot+") on "+e.date)+" ",1),t("a",{onClick:D=>n(G).splice(g,1)},"[x]",8,Le)]))),128))])]),t("div",_e,[t("h3",null,o(n(r)("createPage.risks.title")),1),t("table",null,[t("tr",null,[t("td",null,o(n(r)("createPage.id")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[18]||(i[18]=e=>n(h).id=e)},null,512),[[y,n(h).id]]),b("\xA0 "),c(t("select",{"onUpdate:modelValue":i[19]||(i[19]=e=>n(h).id=e)},[(s(!0),d(I,null,U(n(ce).sort((e,g)=>e.display["en-US"]>g.display["en-US"]?1:-1),e=>(s(),d("option",{key:e.code,value:e.code},o(e.display["en-US"]),9,He))),128))],512),[[H,n(h).id]])])]),t("tr",null,[t("td",null,o(n(r)("createPage.risks.recorded")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[20]||(i[20]=e=>n(h).date=e)},null,512),[[y,n(h).date]])])]),t("tr",null,[t("td",null,o(n(r)("createPage.risks.onset")),1),t("td",null,[c(t("input",{"onUpdate:modelValue":i[21]||(i[21]=e=>n(h).onSetDate=e)},null,512),[[y,n(h).onSetDate]])])]),t("tr",null,[t("td",null,o(n(r)("createPage.risks.recorder")),1),t("td",null,[c(t("select",{"onUpdate:modelValue":i[22]||(i[22]=e=>n(h).recorder=e)},[(s(!0),d(I,null,U(n(u).practitioners,e=>(s(),d("option",{key:e.uuid,value:e.uuid},o(e.prefix+" "+e.given+" "+e.family+" ("+e.org+")"),9,Be))),128))],512),[[H,n(h).recorder]])])])]),t("button",{onClick:i[23]||(i[23]=e=>n(J).push({...n(h)}))},o(n(r)("createPage.add")),1),t("ul",null,[(s(!0),d(I,null,U(n(J),(e,g)=>(s(),d("li",{key:g},[b(o(e.id+" ")+" ",1),t("a",{onClick:D=>n(J).splice(g,1)},"[x]",8,je)]))),128))])]),Ge,t("button",{onClick:fe},o(n(r)("createPage.create")),1),b("\xA0\xA0 "),c(t("input",{"onUpdate:modelValue":i[24]||(i[24]=e=>j.value=e),type:"checkbox"},null,512),[[ue,j.value]]),b(" "+o(n(r)("createPage.clipboard")),1),Je,Ke,f.value?(s(),d("button",{key:2,onClick:i[25]||(i[25]=e=>{f.value=void 0,S.value={error:!1,done:!1,processing:!1}})},o(n(r)("createPage.reset")),1)):Q("",!0),b("\xA0\xA0 "),f.value&&n(u).userIsLogged&&n(w)===n(X).family&&n(M)===n(u).userResource.birthDate?(s(),d("button",{key:3,disabled:S.value.processing||S.value.done,class:xe({error:S.value.error,success:S.value.done}),onClick:ge},o(n(r)("createPage.upload")),11,Qe)):Q("",!0),b("\xA0\xA0 "),f.value?(s(),d("button",{key:4,onClick:i[26]||(i[26]=()=>n(u).vaccinationRecord=f.value)},o(n(r)("createPage.set")),1)):Q("",!0),f.value?(s(),d("pre",We,o(JSON.stringify(f.value,null,2))+`
    `,1)):Q("",!0)]),_:1}))}});var tt=Re(Xe,[["__scopeId","data-v-9de3c950"]]);export{tt as default};
