import{Q as W}from"./QPage.ec953c32.js";import{d as j,u as B,r as h,c as X,ab as Z,ac as m,w as $,S as i,U as w,V as u,j as c,a4 as r,W as g,X as l,a2 as e,Z as C,$ as E,ad as q,F as O,a3 as N,f as v,G as Q,ae as M,af as A,ag as H,ah as x,ai as P,aj as K,ak as Y,al as ee}from"./index.5bf29f0e.js";import{_ as J}from"./plugin-vue_export-helper.21dcd24c.js";import{u as L}from"./vue-i18n.runtime.dff3174f.js";const ae=p=>(Y("data-v-38fa8f98"),p=p(),ee(),p),te={class:"patient-name"},se={class:"section-title"},le={class:"fact-list"},re={key:0},ne=ae(()=>r("br",null,null,-1)),oe={class:"section-title"},ue=["rows"],ie={class:"section-title"},de=["rows"],ce=j({__name:"RuleEngineCard",props:{document:{}},setup(p){const R=B(),{t,locale:F,te:b}=L(),{numberOfFacts:U,resultingFacts:I,getRules:S,facts:z}=H(),T=p;let f=h(JSON.stringify(S(),null,2)),y=h(JSON.stringify(z.value,null,2)),D=h(S()),k=h(!0),n=h(!1),o=h(!1);const V=X(()=>{var s,a;const d=(s=T.document.entry.find(_=>_.resource.resourceType==="Composition"))==null?void 0:s.resource;if(d){const _=Z(T.document,(a=d.subject)==null?void 0:a.reference);return{name:m.getFullName(m.selectName(_.name)),birthDate:new Date(_.birthDate)}}else return{name:"",birthDate:new Date}});function G(d){var s,a;return b("ruleCard.rules."+d.name)?t("ruleCard.rules."+d.name):((a=(s=d.history)==null?void 0:s.at(-1))==null?void 0:a.split(": ")[1])||""}return $(f,d=>{if(n.value)try{D.value=JSON.parse(d),k.value=!0}catch(s){k.value=!1,console.log("Error on rules",s)}}),(d,s)=>(i(),w(e(P),null,{default:u(()=>[c(e(x),{class:"card-title"},{default:u(()=>[r("h2",null,[g(l(e(t)("ruleCard.title"))+" ",1),r("span",te,l(V.value.name),1),g(", "+l(new Intl.DateTimeFormat(e(F)).format(V.value.birthDate)),1)])]),_:1}),c(e(x),null,{default:u(()=>[r("h3",se,l(e(t)("ruleCard.resultsTitle")),1),r("p",null,l(e(I).filter(a=>a.name.indexOf("x_")!=0).length===0?e(t)("ruleCard.noRecommendation",{name:e(m.getFullName)(e(m.selectName)(e(R).userResource.name))}):e(t)("ruleCard.recommendationText",{name:e(m.getFullName)(e(m.selectName)(e(R).userResource.name))})),1),r("ul",le,[(i(!0),C(O,null,E(e(I).filter(a=>a.name.indexOf("x_")!=0),a=>(i(),C("li",{key:a.name,class:"rule-recommandation"},[c(q,{"expand-separator":"",label:G(a)},{default:u(()=>[c(e(P),null,{default:u(()=>[c(e(x),null,{default:u(()=>[r("p",null,l(e(t)("ruleCard.factName"))+" "+l(a.name)+" = "+l(a.value),1),a.history?(i(),C("ul",re,[(i(!0),C(O,null,E(a.history,_=>(i(),C("li",{key:_},l(_),1))),128))])):N("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"])]))),128))])]),_:1}),c(e(K)),c(e(x),null,{default:u(()=>[r("p",null,[g(l(e(t)("ruleCard.resultDescription",{rules:e(D).length,facts:e(U)}))+" ",1),ne,g(" [ "),r("a",{onClick:s[0]||(s[0]=()=>{v(n)?n.value=!e(n):n=!e(n),v(o)?o.value=!1:o=!1})},l(e(n)?e(t)("ruleCard.hideRules"):e(t)("ruleCard.showRules")),1),g(" ] [ "),r("a",{onClick:s[1]||(s[1]=()=>{v(o)?o.value=!e(o):o=!e(o),v(n)?n.value=!1:n=!1})},l(e(o)?e(t)("ruleCard.hideFacts"):e(t)("ruleCard.showFacts")),1),g(" ] ")])]),_:1}),e(n)?(i(),w(e(x),{key:0},{default:u(()=>[r("h3",oe,l(e(t)("ruleCard.rulesTitle")),1),Q(r("textarea",{"onUpdate:modelValue":s[2]||(s[2]=a=>v(f)?f.value=a:f=a),disabled:"",class:A({"invalid-rules":!e(k)}),rows:Math.max(4,Math.min(30,e(f).split(/\r\n|\r|\n/).length)),cols:"50"},null,10,ue),[[M,e(f)]])]),_:1})):N("",!0),e(o)?(i(),w(e(x),{key:1},{default:u(()=>[r("h3",ie,l(e(t)("ruleCard.factsTitle")),1),Q(r("textarea",{"onUpdate:modelValue":s[3]||(s[3]=a=>v(y)?y.value=a:y=a),disabled:"",rows:Math.max(4,Math.min(30,e(y).split(/\r\n|\r|\n/).length)),cols:"50"},null,8,de),[[M,e(y)]])]),_:1})):N("",!0)]),_:1}))}});var me=J(ce,[["__scopeId","data-v-38fa8f98"]]);const _e={key:1,class:"no-document"},pe=j({__name:"IndexPage",setup(p){const{t:R}=L(),t=B();return(F,b)=>e(t).vaccinationRecord?(i(),w(W,{key:0,class:"full-width justify-center"},{default:u(()=>[c(me,{document:e(t).vaccinationRecord},null,8,["document"])]),_:1})):e(t).userIsLogged?(i(),C("p",_e,l(e(R)("immunizationPage.noRecord",{name:e(m.getFullName)(e(m.selectName)(e(t).userResource.name))})),1)):N("",!0)}});var xe=J(pe,[["__scopeId","data-v-2f80d43f"]]);export{xe as default};
