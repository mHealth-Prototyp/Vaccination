import{k as O,r as b,J as $,ay as K,az as G,aA as W,o as J,h as X,l as Z,g as H,aB as Y,aC as j,D as ee,aD as oe,d as te,a7 as ae,aE as ne,u as se,aF as le,S as w,U,V as g,a4 as C,j as m,ah as q,W as k,X as f,a2 as r,aj as re,aq as D,aG as ie,Z as B,$ as ue,F as de,a8 as T,a3 as R,ai as ce,ak as me,al as fe}from"./index.5bf29f0e.js";import{Q as pe}from"./QPage.ec953c32.js";import{u as ve}from"./use-quasar.52a3e444.js";import{u as ge}from"./composables.38e17cfb.js";import{_ as be}from"./plugin-vue_export-helper.21dcd24c.js";import{u as he}from"./vue-i18n.runtime.dff3174f.js";var z=O({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(u,{slots:E,emit:o}){const F=H(),h=b(null);let y=0;const v=[];function _(e){const d=typeof e=="boolean"?e:u.noErrorFocus!==!0,S=++y,V=(s,i)=>{o("validation"+(s===!0?"Success":"Error"),i)},A=s=>{const i=s.validate();return typeof i.then=="function"?i.then(c=>({valid:c,comp:s}),c=>({valid:!1,comp:s,err:c})):Promise.resolve({valid:i,comp:s})};return(u.greedy===!0?Promise.all(v.map(A)).then(s=>s.filter(i=>i.valid!==!0)):v.reduce((s,i)=>s.then(()=>A(i).then(c=>{if(c.valid===!1)return Promise.reject(c)})),Promise.resolve()).catch(s=>[s])).then(s=>{if(s===void 0||s.length===0)return S===y&&V(!0),!0;if(S===y){const{comp:i,err:c}=s[0];if(c!==void 0&&console.error(c),V(!1,i),d===!0){const I=s.find(({comp:n})=>typeof n.focus=="function"&&Y(n.$)===!1);I!==void 0&&I.comp.focus()}}return!1})}function N(){y++,v.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function l(e){e!==void 0&&j(e);const d=y+1;_().then(S=>{d===y&&S===!0&&(u.onSubmit!==void 0?o("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function p(e){e!==void 0&&j(e),o("reset"),ee(()=>{N(),u.autofocus===!0&&u.noResetFocus!==!0&&P()})}function P(){oe(()=>{if(h.value===null)return;const e=h.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||h.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||h.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(h.value.querySelectorAll("[tabindex]"),d=>d.tabIndex>-1);e!=null&&e.focus({preventScroll:!0})})}$(K,{bindComponent(e){v.push(e)},unbindComponent(e){const d=v.indexOf(e);d>-1&&v.splice(d,1)}});let x=!1;return G(()=>{x=!0}),W(()=>{x===!0&&u.autofocus===!0&&P()}),J(()=>{u.autofocus===!0&&P()}),Object.assign(F.proxy,{validate:_,resetValidation:N,submit:l,reset:p,focus:P,getValidationComponents:()=>v}),()=>X("form",{class:"q-form",ref:h,onSubmit:l,onReset:p},Z(E.default))}}),M=[{emailAddress:"dev@on.ly",password:"test",mobilePhoneNumber:"079 123 45 67",firstName:"Matteo",lastName:"Lecomte",description:{de:"Nur zu Entwicklungszwecken",fr:"\xC0 des fins de d\xE9veloppement uniquement"}},{emailAddress:"noah@pichard.ch",password:"np",firstName:"Noah",lastName:"Pichard",mobilePhoneNumber:"-",description:{de:"Ein neugeborenes Kind",fr:"Un nouveau-n\xE9"}},{emailAddress:"verena@broenni.ch",password:"vb",firstName:"Verena",lastName:"Br\xF6nnimann",mobilePhoneNumber:"078 999 88 77",description:{de:"Eine Seniorin mit COPD",fr:"Une personne \xE2g\xE9e atteinte de BPCO"}},{emailAddress:"sus@katz.ch",password:"sk",firstName:"Susanna",lastName:"Katz",mobilePhoneNumber:"079 987 65 43",description:{de:"Eine junge Pflegefachfrau",fr:"Une jeune infirmi\xE8re"}},{emailAddress:"bruce@wen.ch",password:"bw",firstName:"Bruce",lastName:"Wen",mobilePhoneNumber:"079 111 22 33",description:{de:"Ein Fledermausforscher",fr:"Un chercheur de chauves-souris"}}];const ye=u=>(me("data-v-20706db0"),u=u(),fe(),u),_e={style:{overflow:"auto"}},Ne={class:"text-body2"},Pe={class:"hint-link-items"},xe=ye(()=>C("br",null,null,-1)),we={key:0,class:"text-body2 warning"},Ce={class:"text-body2"},Se={class:"phonenumber"},ke={key:0,class:"text-body2 warning"},Ee=te({__name:"LoginPage",setup(u){const E=ve(),{t:o,locale:F}=he(),h=ae(),y=ne(),v=se(),_=b(""),N=b(""),l=b(le),p=b(!1),P=b(!1),x=b(null),e=b(""),d=b(!1),{epdUtils:S}=ge();function V(n){return n.description[F.value.substring(0,2)]}function A(n){n.preventDefault();const t=M.find(a=>a.emailAddress===_.value);t&&t.password===N.value?(l.value=t,L()):P.value=!0}function L(){p.value=!0,S.useITI78({given:l.value.firstName,family:l.value.lastName}).then(n=>{var t,a;n.length===0?(E.notify({message:o("common.error"),caption:o("login.loginError"),type:"negative",position:"top-right"}),console.error("No corresponding patient found on EPD Playground for "+l.value.firstName+" "+l.value.lastName+"."),p.value=!1):(v.$patch({user:l.value,userResource:n[0]}),h.push({path:(a=(t=y.redirectedFrom)==null?void 0:t.path)!=null?a:"/"}))}).catch(n=>{E.notify({message:o("common.error"),caption:o("login.loginError"),type:"negative",position:"top-right"}),console.error("Something went wrong logging in",n),p.value=!1})}function s(){i(4),E.notify({message:o("login.messageTitle")+l.value.mobilePhoneNumber,caption:o("login.messageText")+x.value,position:"top-right"})}function i(n){const t=Math.floor(Math.random()*Math.pow(10,n)).toString();x.value="0".repeat(t.length-n)+t}function c(n){n.preventDefault(),x.value===e.value&&l.value?L():d.value=!0}function I(){var n,t,a,Q;return((n=l.value)==null?void 0:n.mobilePhoneNumber.substring(0,2))+"\u2022 \u2022\u2022\u2022 "+((Q=l.value)==null?void 0:Q.mobilePhoneNumber.substring(((t=l.value)==null?void 0:t.mobilePhoneNumber.length)-5,(a=l.value)==null?void 0:a.mobilePhoneNumber.length))}return(n,t)=>(w(),U(pe,{class:"full-width row justify-center content-start"},{default:g(()=>[C("div",_e,[m(ce,{flat:"",bordered:""},{default:g(()=>[m(q,{class:"card-title"},{default:g(()=>[k(f(r(o)("login.welcome1")),1)]),_:1}),m(re),x.value?(w(),U(q,{key:1},{default:g(()=>[C("p",Ce,[k(f(r(o)("login.enterCode1"))+" ",1),C("span",Se,f(I()),1),k(" "+f(r(o)("login.enterCode2")),1)]),C("span",{href:"#",class:"text-body2 resend-link",onClick:t[2]||(t[2]=a=>s())},f(r(o)("login.resend")),1),m(z,{id:"code-form",style:{"text-align":"center"}},{default:g(()=>[m(D,{modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value=a),class:"q-my-md",outlined:"",type:"text",label:r(o)("login.codeLabel"),autofocus:""},null,8,["modelValue","label"]),m(T,{id:"code-button",unelevated:"",color:"primary","text-color":"onPrimary",type:"submit",loading:p.value,label:r(o)("login.checkLabel"),disable:p.value||e.value==="",onClick:c},null,8,["loading","label","disable"])]),_:1}),d.value?(w(),B("p",ke,f(r(o)("login.invalidCode")),1)):R("",!0)]),_:1})):(w(),U(q,{key:0},{default:g(()=>[C("p",Ne,f(r(o)("login.welcome2")),1),m(z,{class:"",style:{"text-align":"center"}},{default:g(()=>[m(D,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=a=>_.value=a),class:"q-my-md",outlined:"",type:"email",label:r(o)("login.emailAddressLabel")},{default:g(()=>[m(ie,null,{default:g(()=>[k(f(r(o)("login.possibleLogins"))+" ",1),C("ul",Pe,[(w(!0),B(de,null,ue(r(M).filter(a=>a.emailAddress!=="dev@on.ly"),a=>(w(),B("li",{key:a.emailAddress},[k(f(a.emailAddress+" | "+a.password),1),xe,k(f("("+V(a)+")"),1)]))),128))])]),_:1})]),_:1},8,["modelValue","label"]),m(D,{modelValue:N.value,"onUpdate:modelValue":t[1]||(t[1]=a=>N.value=a),class:"q-my-md",outlined:"",type:"password",label:r(o)("login.passwordLabel")},null,8,["modelValue","label"]),m(T,{id:"login-button",unelevated:"",color:"primary","text-color":"onPrimary",type:"submit",loading:p.value,label:r(o)("login.loginLabel"),disable:p.value||N.value===""||_.value==="",onClick:A},null,8,["loading","label","disable"])]),_:1}),P.value?(w(),B("p",we,f(r(o)("login.invalidPassword")),1)):R("",!0)]),_:1}))]),_:1})])]),_:1}))}});var Ue=be(Ee,[["__scopeId","data-v-20706db0"]]);export{Ue as default};
